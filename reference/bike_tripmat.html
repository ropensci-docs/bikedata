<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Extract station-to-station trip matrix or data.frame from SQLite3 database"><title>Extract station-to-station trip matrix or data.frame from SQLite3 database — bike_tripmat • bikedata</title><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extract station-to-station trip matrix or data.frame from SQLite3 database — bike_tripmat"><meta property="og:description" content="Extract station-to-station trip matrix or data.frame from SQLite3 database"><meta property="og:image" content="https://docs.ropensci.org/bikedata/logo.png"><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css"><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript><!-- End Matomo Code --></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">bikedata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.5.046</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="nav-link" href="../articles/bikedata.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/bikedata/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Extract station-to-station trip matrix or data.frame from SQLite3 database</h1>
      <small class="dont-index">Source: <a href="https://github.com/ropensci/bikedata/blob/HEAD/R/tripmat.R" class="external-link"><code>R/tripmat.R</code></a></small>
      <div class="d-none name"><code>bike_tripmat.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Extract station-to-station trip matrix or data.frame from SQLite3 database</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">bike_tripmat</span><span class="op">(</span></span>
<span>  <span class="va">bikedb</span>,</span>
<span>  <span class="va">city</span>,</span>
<span>  <span class="va">start_date</span>,</span>
<span>  <span class="va">end_date</span>,</span>
<span>  <span class="va">start_time</span>,</span>
<span>  <span class="va">end_time</span>,</span>
<span>  <span class="va">weekday</span>,</span>
<span>  <span class="va">member</span>,</span>
<span>  <span class="va">birth_year</span>,</span>
<span>  <span class="va">gender</span>,</span>
<span>  standardise <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  long <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>bikedb</dt>
<dd><p>A string containing the path to the SQLite3 database.
If no directory specified, it is presumed to be in <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code>.</p></dd>


<dt>city</dt>
<dd><p>City for which tripmat is to be aggregated</p></dd>


<dt>start_date</dt>
<dd><p>If given (as year, month, day) , extract only those records
from and including this date</p></dd>


<dt>end_date</dt>
<dd><p>If given (as year, month, day), extract only those records to
and including this date</p></dd>


<dt>start_time</dt>
<dd><p>If given, extract only those records starting from and
including this time of each day</p></dd>


<dt>end_time</dt>
<dd><p>If given, extract only those records ending at and including
this time of each day</p></dd>


<dt>weekday</dt>
<dd><p>If given, extract only those records including the nominated
weekdays. This can be a vector of numeric, starting with Sunday=1, or
unambiguous characters, so "sa" and "tu" for Saturday and Tuesday.</p></dd>


<dt>member</dt>
<dd><p>If given, extract only trips by registered members
(<code>member = 1</code> or <code>TRUE</code>) or not (<code>member = 0</code> or
<code>FALSE</code>).</p></dd>


<dt>birth_year</dt>
<dd><p>If given, extract only trips by registered members whose
declared birth years equal or lie within the specified value or values.</p></dd>


<dt>gender</dt>
<dd><p>If given, extract only records for trips by registered
users declaring the specified genders (<code>f/m/.</code> or <code>2/1/0</code>).</p></dd>


<dt>standardise</dt>
<dd><p>If TRUE, numbers of trips are standardised to the
operating durations of each stations, so trip numbers are increased for
stations that have only operated a short time, and vice versa.</p></dd>


<dt>long</dt>
<dd><p>If FALSE, a square tripmat of (num-stations, num_stations) is
returned; if TRUE, a long-format matrix of (stn-from, stn-to, ntrips) is
returned.</p></dd>


<dt>quiet</dt>
<dd><p>If FALSE, progress is displayed on screen</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>If <code>long = FALSE</code>, a square matrix of numbers of trips between
each station, otherwise a long-form <span class="pkg">tibble</span> with three columns of of
(<code>start_station_id, end_station_id, numtrips</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The <code>city</code> parameter should be given for databases containing data
from multiple cities, otherwise most of the resultant trip matrix is likely
to be empty.  Both dates and times may be given either in numeric or
character format, with arbitrary (or no) delimiters between fields. Single
numeric times are interpreted as hours, with 24 interpreted as day's end at
23:59:59.</p>
<p>If <code>standardise = TRUE</code>, the trip matrix will have the same number
of trips, but they will be re-distributed as described, with more recent
stations having more trips than older stations. Trip number are also
non-integer in this case, whereas they are always integer-valued for
<code>standardise = FALSE</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span> <span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="bike_write_test_data.html">bike_write_test_data</a></span> <span class="op">(</span>data_dir <span class="op">=</span> <span class="va">data_dir</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># or download some real data!</span></span></span>
<span class="r-in"><span><span class="co"># dl_bikedata (city = "la", data_dir = data_dir)</span></span></span>
<span class="r-in"><span><span class="va">bikedb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span> <span class="op">(</span><span class="va">data_dir</span>, <span class="st">"testdb"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="store_bikedata.html">store_bikedata</a></span> <span class="op">(</span>data_dir <span class="op">=</span> <span class="va">data_dir</span>, bikedb <span class="op">=</span> <span class="va">bikedb</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># create database indexes for quicker access:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="index_bikedata_db.html">index_bikedata_db</a></span> <span class="op">(</span>bikedb <span class="op">=</span> <span class="va">bikedb</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu">bike_tripmat</span> <span class="op">(</span>bikedb <span class="op">=</span> <span class="va">bikedb</span>, city <span class="op">=</span> <span class="st">"ny"</span><span class="op">)</span> <span class="co"># full trip matrix</span></span></span>
<span class="r-in"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu">bike_tripmat</span> <span class="op">(</span>bikedb <span class="op">=</span> <span class="va">bikedb</span>, city <span class="op">=</span> <span class="st">"ny"</span>,</span></span>
<span class="r-in"><span>                    start_date <span class="op">=</span> <span class="fl">20161201</span>, end_date <span class="op">=</span> <span class="fl">20161201</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu">bike_tripmat</span> <span class="op">(</span>bikedb <span class="op">=</span> <span class="va">bikedb</span>, city <span class="op">=</span> <span class="st">"ny"</span>, start_time <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu">bike_tripmat</span> <span class="op">(</span>bikedb <span class="op">=</span> <span class="va">bikedb</span>, city <span class="op">=</span> <span class="st">"ny"</span>, start_time <span class="op">=</span> <span class="st">"01:00"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu">bike_tripmat</span> <span class="op">(</span>bikedb <span class="op">=</span> <span class="va">bikedb</span>, city <span class="op">=</span> <span class="st">"ny"</span>, end_time <span class="op">=</span> <span class="st">"01:00"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu">bike_tripmat</span> <span class="op">(</span>bikedb <span class="op">=</span> <span class="va">bikedb</span>, city <span class="op">=</span> <span class="st">"ny"</span>,</span></span>
<span class="r-in"><span>                    start_date <span class="op">=</span> <span class="fl">20161201</span>, start_time <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu">bike_tripmat</span> <span class="op">(</span>bikedb <span class="op">=</span> <span class="va">bikedb</span>, city <span class="op">=</span> <span class="st">"ny"</span>, start_date <span class="op">=</span> <span class="fl">20161201</span>,</span></span>
<span class="r-in"><span>                    end_date <span class="op">=</span> <span class="fl">20161201</span>, start_time <span class="op">=</span> <span class="fl">1</span>, end_time <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu">bike_tripmat</span> <span class="op">(</span>bikedb <span class="op">=</span> <span class="va">bikedb</span>, city <span class="op">=</span> <span class="st">"ny"</span>, weekday <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu">bike_tripmat</span> <span class="op">(</span>bikedb <span class="op">=</span> <span class="va">bikedb</span>, city <span class="op">=</span> <span class="st">"ny"</span>,</span></span>
<span class="r-in"><span>                    weekday <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="st">"sa"</span>, <span class="st">"th"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu">bike_tripmat</span> <span class="op">(</span>bikedb <span class="op">=</span> <span class="va">bikedb</span>, city <span class="op">=</span> <span class="st">"ny"</span>,</span></span>
<span class="r-in"><span>                    weekday <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"f"</span>, <span class="st">"th"</span>, <span class="st">"sa"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu">bike_tripmat</span> <span class="op">(</span>bikedb <span class="op">=</span> <span class="va">bikedb</span>, city <span class="op">=</span> <span class="st">"ny"</span>, member <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu">bike_tripmat</span> <span class="op">(</span>bikedb <span class="op">=</span> <span class="va">bikedb</span>, city <span class="op">=</span> <span class="st">"ny"</span>, birth_year <span class="op">=</span> <span class="fl">1976</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu">bike_tripmat</span> <span class="op">(</span>bikedb <span class="op">=</span> <span class="va">bikedb</span>, city <span class="op">=</span> <span class="st">"ny"</span>, birth_year <span class="op">=</span> <span class="fl">1976</span><span class="op">:</span><span class="fl">1990</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu">bike_tripmat</span> <span class="op">(</span>bikedb <span class="op">=</span> <span class="va">bikedb</span>, city <span class="op">=</span> <span class="st">"ny"</span>, gender <span class="op">=</span> <span class="st">"f"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu">bike_tripmat</span> <span class="op">(</span>bikedb <span class="op">=</span> <span class="va">bikedb</span>, city <span class="op">=</span> <span class="st">"ny"</span>,</span></span>
<span class="r-in"><span>                    gender <span class="op">=</span> <span class="st">"m"</span>, birth_year <span class="op">=</span> <span class="fl">1976</span><span class="op">:</span><span class="fl">1990</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="bike_rm_test_data.html">bike_rm_test_data</a></span> <span class="op">(</span>data_dir <span class="op">=</span> <span class="va">data_dir</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="bike_rm_db.html">bike_rm_db</a></span> <span class="op">(</span><span class="va">bikedb</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># don't forget to remove real data!</span></span></span>
<span class="r-in"><span><span class="co"># file.remove (list.files (data_dir, pattern = ".zip"))</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg"></div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul><h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul></div>
                    <div class="col-md-3 col-sm-4">
                        <ul><h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul></div>
                    <div class="col-md-2 col-sm-4">
                        <ul><h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul></div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer></div>

  

  

  </body></html>

